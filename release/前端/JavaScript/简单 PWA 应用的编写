{"NM":"简单 PWA 应用的编写","CTS":[{"NT":"h","CT":"简单 PWA 应用的编写","CL":"#333"},{"NT":"p","CT":"我的示例项目地址","CL":"#333"},{"NT":"link","HF":"https://github.com/BHznJNs/digital-clock-pwa","CT":"GitHub: BHznJNs/digital-clock-pwa","CL":"#333"},{"NT":"floor","CTS":[{"NT":"h","CT":"manifest 文件","CL":"#333"},{"NT":"floor","CTS":[{"NT":"h","CT":"引入","CL":"#333"},{"NT":"code","LG":"xml","CT":"&lt;link rel=\"manifest\" href=\"manifest.json\"&gt;\n"}]},{"NT":"floor","CTS":[{"NT":"h","CT":"组成","CL":"#333"},{"NT":"list","CTS":[{"NT":"li","CT":"##必要##","CL":"#333"},{"NT":"list","OL":true,"CTS":[{"NT":"li","CT":"name | 应用名称","CL":"#333"},{"NT":"li","CT":"icons | 应用图标","CL":"#333"},{"NT":"li","CT":"start_url | 应用启动时加载的 URL","CL":"#333"}]},{"NT":"li","CT":"##非必要##","CL":"#333"},{"NT":"list","OL":true,"CTS":[{"NT":"li","CT":"background_color | 应用程序启动，在程序界面出现之前的背景颜色","CL":"#333"},{"NT":"li","CT":"categories | 应用的类别","CL":"#333"},{"NT":"li","CT":"description | 应用的描述","CL":"#333"},{"NT":"li","CT":"display | 应用的显示方式，有 fullscreen，standalone，minimal-ui，browser 可选，默认为 standalone","CL":"#333"},{"NT":"li","CT":"theme_color | 应用的主题颜色","CL":"#333"},{"NT":"li","CT":"shortcuts | 应用程序的快捷方式","CL":"#333"}]}],"OL":true}]},{"NT":"floor","CTS":[{"NT":"h","CT":"示例","CL":"#333"},{"NT":"code","LG":"json","CT":"{\n    \"name\": \"digitalClock\",\n    \"lang\": \"en-US\",\n    \"display\": \"fullscreen\",\n    \"description\": \"A simple digital clock which is a pwa web App.\",\n    \"start_url\": \"../index.html\",\n    \"theme_color\": \"white\",\n    \"background_color\": \"white\",\n    \"icons\": [{\n        \"src\": \"./favicon.png\",\n        \"sizes\": \"192x192\",\n        \"type\": \"image/png\"\n    }]\n}"}]}]},{"NT":"floor","CTS":[{"NT":"h","CT":"register.js","CL":"#333"},{"NT":"code","LG":"javascript","CT":"// if 判断浏览器是否支持 serviceWorker\nif (\"serviceWorker\" in navigator) {\n    // 如果支持，注册 serviceWorker.js\n    navigator.serviceWorker\n    .register(\"sw.js\")\n}"}]},{"NT":"floor","CTS":[{"NT":"h","CT":"sw.js 文件","CL":"#333"},{"NT":"floor","CTS":[{"NT":"h","CT":"定义缓存名称和要缓存的文件","CL":"#333"},{"NT":"code","LG":"javascript","CT":"const cacheName = \"digitalClock-v1\"\nconst appShellFiles = [\n    \"./\", \"./index.html\",\n    \"./script/main.js\",\n    \"./script/register.js\",\n    \"./style/style.css\",\n    \"./style/color.css\",\n    \"./assets/dark.svg\",\n    \"./assets/light.svg\",\n    \"./assets/favicon.png\",\n    \"./assets/manifest.json\",\n    \"./assets/font/DS-DIGIB.TTF\",\n    \"./assets/githubIcons/dark.svg\",\n    \"./assets/githubIcons/light.svg\",\n]"}]},{"NT":"floor","CTS":[{"NT":"h","CT":"进行应用安装时事件监听","CL":"#333"},{"NT":"code","LG":"javascript","CT":"self.addEventListener(\"install\", (e) =&gt; {\n    console.log(\"[Service Worker] Installing...\")\n    // waitUntil: 等待传入的函数执行完成\n    e.waitUntil((async () =&gt; {\n        // 为当前应用创建新的 cache\n        const cache = await caches.open(cacheName)\n        console.log(\"[Service Worker] Caching all: app shell and content\")\n        // 将上文中要缓存的文件进行缓存\n        await cache.addAll(appShellFiles)\n        console.log(\"[Service Worker] Installed all\")\n    })())\n})"}]},{"NT":"floor","CTS":[{"NT":"h","CT":"进行应用访问网络时的事件监听","CL":"#333"},{"NT":"p","CT":"注：这一步是确保应用能够离线使用的关键","CL":"#333"},{"NT":"code","LG":"javascript","CT":"self.addEventListener(\"fetch\", (e) =&gt; {\n    const target = e.request // 请求对象\n    if (caches.match(target)) {\n        // 如果缓存中存在要请求的文件，\n        // 使用缓存中对应的文件进行响应\n        e.respondWith(caches.match(target))\n        console.log(`[Service Worker] Used cached ${target.url} to response request`)\n    } else {\n        // 如果缓存中不存在要请求的文件，\n        // 对目标文件进行请求，使用 fetch 函数返回值进行响应\n        e.respondWith(fetch(target))\n        console.log(`[Service Worker] Fetching ${target.url}`)\n    }\n})"}]}]}]}